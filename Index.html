<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Interrogazioni Classe</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide/dist/lucide.js"></script>
</head>
<body class="bg-gradient-to-r from-purple-100 to-pink-100 min-h-screen p-6 font-sans">

<div class="max-w-xl mx-auto bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-2xl font-bold text-center mb-6 text-purple-700">Interrogazioni Classe</h1>

    <div class="flex flex-col sm:flex-row gap-2 mb-4">
        <input id="name" type="text" placeholder="Nome"
            class="flex-1 p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400">
        <input id="date" type="date"
            class="p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400">
        <select id="subject" class="p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400">
            <option value="Italiano">Italiano</option>
            <option value="Storia">Storia</option>
        </select>
        <button onclick="addStudent()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 flex items-center gap-1">
            <i data-lucide="plus-circle"></i> Salva
        </button>
    </div>

    <h2 class="text-xl font-semibold text-purple-600 mb-2">Lista studenti:</h2>
    <ul id="studentList" class="space-y-2"></ul>
</div>

<script>
async function fetchStudents() {
    const res = await fetch('/.netlify/functions/get-students');
    const students = await res.json();
    const list = document.getElementById('studentList');
    list.innerHTML = '';
    students.forEach(s => {
        const li = document.createElement('li');
        li.className = "flex justify-between items-center bg-purple-50 p-3 rounded-lg shadow-sm hover:bg-purple-100 transition";
        li.innerHTML = `
            <span><span class="font-bold text-purple-700">${s.subject}</span> - ${s.name} (${s.last_interrogation})</span>
            <button onclick="deleteStudent(${s.id})" class="text-red-500 hover:text-red-700 flex items-center gap-1">
                <i data-lucide="trash-2"></i> Cancella
            </button>
        `;
        list.appendChild(li);
    });
    lucide.replace(); // aggiorna icone
}

async function addStudent() {
    const name = document.getElementById('name').value;
    const date = document.getElementById('date').value;
    const subject = document.getElementById('subject').value;
    if(!name || !date || !subject) return alert("Compila tutti i campi!");
    await fetch('/.netlify/functions/add-student', {
        method: 'POST',
        body: JSON.stringify({ name, last_interrogation: date, subject })
    });
    document.getElementById('name').value = '';
    document.getElementById('date').value = '';
    fetchStudents();
}

async function deleteStudent(id) {
    if(!confirm("Sei sicuro di voler cancellare questo studente?")) return;
    await fetch('/.netlify/functions/delete-student', {
        method: 'POST',
        body: JSON.stringify({ id })
    });
    fetchStudents();
}

fetchStudents();
</script>

</body>
</html>
