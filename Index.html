<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Interrogazioni Classe - Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide/dist/lucide.js"></script>
<style>
    /* Animazioni leggere e gradienti */
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }
    .italiano { background: #e0c3fc; border-left: 4px solid #9b5de5; }
    .storia { background: #ffdac1; border-left: 4px solid #ff7b00; }
</style>
</head>
<body class="bg-gradient-to-r from-purple-100 via-pink-100 to-yellow-100 min-h-screen p-6 font-sans">

<div class="max-w-5xl mx-auto">
    <h1 class="text-4xl font-bold text-center mb-8 text-purple-700 drop-shadow-lg">ðŸ“š Interrogazioni Classe</h1>

    <!-- Form aggiungi studente -->
    <div class="bg-white p-6 rounded-xl shadow-lg mb-8 flex flex-col sm:flex-row gap-2 items-center">
        <input id="name" type="text" placeholder="Nome studente"
            class="flex-1 p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400">
        <input id="date" type="date"
            class="p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400">
        <select id="subject" class="p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400">
            <option value="Italiano">Italiano</option>
            <option value="Storia">Storia</option>
        </select>
        <button onclick="addStudent()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 flex items-center gap-1">
            <i data-lucide="plus-circle"></i> Salva
        </button>
    </div>

    <!-- Dashboard materie -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
            <h2 class="text-2xl font-semibold text-purple-700 mb-4 flex items-center gap-2">
                <i data-lucide="book-open"></i> Italiano
            </h2>
            <ul id="italianoList" class="space-y-2"></ul>
        </div>
        <div>
            <h2 class="text-2xl font-semibold text-orange-700 mb-4 flex items-center gap-2">
                <i data-lucide="book"></i> Storia
            </h2>
            <ul id="storiaList" class="space-y-2"></ul>
        </div>
    </div>
</div>

<script>
// Utility per formattare la data senza orario
function formatDate(dateString) {
    const d = new Date(dateString);
    return d.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: 'numeric' });
}

// Fetch studenti dal server
async function fetchStudents() {
    const res = await fetch('/.netlify/functions/get-students');
    const students = await res.json();
    const italianoList = document.getElementById('italianoList');
    const storiaList = document.getElementById('storiaList');
    italianoList.innerHTML = '';
    storiaList.innerHTML = '';
    students.forEach(s => {
        const li = document.createElement('li');
        li.className = `flex justify-between items-center p-3 rounded-lg shadow-sm fade-in ${s.subject.toLowerCase()}`;
        li.innerHTML = `
            <span>${s.name} - ${formatDate(s.last_interrogation)}</span>
            <button onclick="deleteStudent(${s.id})" class="text-red-500 hover:text-red-700 flex items-center gap-1">
                <i data-lucide="trash-2"></i> Cancella
            </button>
        `;
        if(s.subject === "Italiano") italianoList.appendChild(li);
        else if(s.subject === "Storia") storiaList.appendChild(li);
    });
    lucide.replace(); // aggiorna icone
}

// Aggiungi studente
async function addStudent() {
    const name = document.getElementById('name').value;
    const date = document.getElementById('date').value;
    const subject = document.getElementById('subject').value;
    if(!name || !date || !subject) return alert("Compila tutti i campi!");
    await fetch('/.netlify/functions/add-student', {
        method: 'POST',
        body: JSON.stringify({ name, last_interrogation: date, subject })
    });
    document.getElementById('name').value = '';
    document.getElementById('date').value = '';
    fetchStudents();
}

// Cancella studente
async function deleteStudent(id) {
    if(!confirm("Sei sicuro di voler cancellare questo studente?")) return;
    await fetch('/.netlify/functions/delete-student', {
        method: 'POST',
        body: JSON.stringify({ id })
    });
    fetchStudents();
}

// Fetch iniziale
fetchStudents();

// Aggiorna automaticamente ogni 30 secondi
setInterval(fetchStudents, 30000);

</script>

</body>
</html>
