<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Interrogazioni Classe</title>
<style>
    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 30px; }
    h1 { color: #333; }
    input, select, button { padding: 10px; margin: 5px; border-radius: 8px; border: 1px solid #ccc; }
    button { cursor: pointer; background-color: #4CAF50; color: white; border: none; }
    button:hover { background-color: #45a049; }
    ul { list-style-type: none; padding: 0; }
    li { background: white; margin: 5px 0; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    .subject { font-weight: bold; margin-right: 10px; }
</style>
</head>
<body>

<h1>Interrogazioni Classe</h1>

<div>
    <input type="text" id="name" placeholder="Nome">
    <input type="date" id="date">
    <select id="subject">
        <option value="Italiano">Italiano</option>
        <option value="Storia">Storia</option>
    </select>
    <button onclick="addStudent()">Salva</button>
</div>

<h2>Lista studenti:</h2>
<ul id="studentList"></ul>

<script>
async function fetchStudents() {
    const res = await fetch('/.netlify/functions/get-students');
    const students = await res.json();
    const list = document.getElementById('studentList');
    list.innerHTML = '';
    students.forEach(s => {
        const li = document.createElement('li');
        li.innerHTML = `<span><span class="subject">${s.subject}</span>${s.name} - ${s.last_interrogation}</span>
                        <button onclick="deleteStudent(${s.id})" style="background:#f44336;">Cancella</button>`;
        list.appendChild(li);
    });
}

async function addStudent() {
    const name = document.getElementById('name').value;
    const date = document.getElementById('date').value;
    const subject = document.getElementById('subject').value;
    if(!name || !date || !subject) return alert("Compila tutti i campi!");
    await fetch('/.netlify/functions/add-student', {
        method: 'POST',
        body: JSON.stringify({ name, last_interrogation: date, subject })
    });
    document.getElementById('name').value = '';
    document.getElementById('date').value = '';
    fetchStudents();
}

async function deleteStudent(id) {
    await fetch('/.netlify/functions/delete-student', {
        method: 'POST',
        body: JSON.stringify({ id })
    });
    fetchStudents();
}

fetchStudents();
</script>

</body>
</html>
